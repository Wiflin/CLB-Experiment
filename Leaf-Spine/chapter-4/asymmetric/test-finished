#!/bin/bash

if [[  $# -ne 1 && $# -ne 2 && $# -ne 3 ]];then

	echo "Usage: "
	echo " $0 test [ load ]"
	echo " $0 caculate servers flows"
	exit

fi 

methods=("ECMP" "CLOVE" "CONGA" "CLB" "HERMES")
load=`seq 0.1 0.1 1`



# r=`date`
# echo $r
# echo $?

testf()
{

	loadc=$1

	for method in ${methods[@]}
	do
		loadfile="./load-$loadc/$method/InputFlow-FCT*"
		if [ ! -e $loadfile ];then
			return 1
		fi
	done

	return 0
}


caculate()
{
	loadc=$1
	servers=$2
	flows=$3

	result="$1"

	for method in ${methods[@]}
	do
		filename="./load-$loadc/$method/InputFlow-FCT-$servers-$flows.tr"
		# echo caculate file $filename
		r=`python3 ./untitled0.py $filename | cut -d " " -f 5`
		result="$result $r"
	done
	echo $result
}



if [ "$1"x == "test"x ]; then


	if [ "$2"x != ""x ]
	then
		load=$2
	fi

	for i in ${load[@]}
	do
		testf $i
		echo "test load-$i ->$?"
	done


	exit
fi


if [ "$1"x == "caculate"x ]; then


	servers=$2
	flows=$3

	mstr="load"
	for method in ${methods[@]}
	do
		mstr="$mstr $method"
	done
	echo $mstr

	for i in ${load[@]}
	do
		testf $i
		# echo "test load-$i ->$?"
		
		if [ $? == 0 ];then
			caculate $i $servers $flows
		fi

	done

	exit
fi
